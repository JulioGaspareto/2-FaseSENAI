CREATE DATABASE LojaY;
USE LojaY;


CREATE TABLE representante (
    id_representante INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100),
    cnpj BIGINT UNIQUE
);

CREATE TABLE produto (
    id_produto INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100),
    codigo VARCHAR(50),
    estoque INT
);


CREATE TABLE compra (
    id_compra INT PRIMARY KEY AUTO_INCREMENT,
    data_horario DATETIME,
    quantidade INT,
    produto_id INT,
    representante_id INT,
    FOREIGN KEY (produto_id) REFERENCES produto(id_produto),
    FOREIGN KEY (representante_id) REFERENCES representante(id_representante)
);




INSERT INTO representante (nome, cnpj) VALUES
('Carlos Silva', 11223344556677),
('Maria Oliveira', 99887766554433),
('João Mendes', 55443322119988);

INSERT INTO produto (nome, codigo, estoque) VALUES
('Mouse Gamer', 'M001', 50),
('Teclado Mecânico', 'T002', 30),
('Monitor 24"', 'MN03', 20),
('Headset RGB', 'H004', 15),
('Cadeira Gamer', 'C005', 10);




SELECT nome, estoque 
FROM produto
ORDER BY estoque DESC
LIMIT 1;

SELECT nome, estoque 
FROM produto
ORDER BY estoque ASC
LIMIT 1;





INSERT INTO compra (data_horario, quantidade, produto_id, representante_id)
VALUES (NOW(), 5, 1, 1);
UPDATE produto SET estoque = estoque - 5 WHERE id_produto = 1;

INSERT INTO compra (data_horario, quantidade, produto_id, representante_id)
VALUES (NOW(), 3, 2, 1);
UPDATE produto SET estoque = estoque - 3 WHERE id_produto = 2;


INSERT INTO compra (data_horario, quantidade, produto_id, representante_id)
VALUES (NOW(), 4, 3, 2);
UPDATE produto SET estoque = estoque - 4 WHERE id_produto = 3;

INSERT INTO compra (data_horario, quantidade, produto_id, representante_id)
VALUES (NOW(), 2, 4, 2);
UPDATE produto SET estoque = estoque - 2 WHERE id_produto = 4;


INSERT INTO compra (data_horario, quantidade, produto_id, representante_id)
VALUES (NOW(), 1, 5, 3);
UPDATE produto SET estoque = estoque - 1 WHERE id_produto = 5;

INSERT INTO compra (data_horario, quantidade, produto_id, representante_id)
VALUES (NOW(), 6, 1, 3);
UPDATE produto SET estoque = estoque - 6 WHERE id_produto = 1;



CREATE VIEW view_media_compra AS
SELECT 
    produto_id,
    AVG(quantidade) AS media_quantidade
FROM compra
GROUP BY produto_id;


SELECT * FROM view_media_compra;



SELECT DISTINCT nome FROM representante;

SELECT nome FROM representante
GROUP BY nome;